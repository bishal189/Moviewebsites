{% extends 'base.html' %}
{% load static %}
{% block  title %}
	<title>FlixTV â€“ Movies & TV Shows, Online cinema HTML Template</title>
{% endblock %}

{% block content %}
	<!-- header (hidden style) -->
{% include 'include/header.html' %}	

	<!-- details -->
	<section style="padding:0px;" class="section section--head section--head-fixed section--gradient section--details-bg">
		<div class="container">
			<!-- article -->
			<div class="article">
				<div class="row">
						<div class="article__content">
								
							<h1>{{ product.album_name }}</h1>
							
													</div>
						<!-- end article content -->
					</div>

					<div class="col-12 col-xl-8">
						<!-- categories -->
						<div class="categories">
							<h3 class="categories__title">Genres</h3>
							{% for gen in product.genre.all  %}
							<a href="{% url 'categorybygenre' gen.category_name %}" class="categories__item">{{ gen.category_name }}</a>
							{% endfor %}
						</div>
						<!-- end categories -->

					
					</div>
<div id='counter' style="color:white;margin-top:25px;font-size:20px;"></div>
				
						<div class="row row--grid">

							{% for item in movies %}
							
						<div  style="margin-right:18px;"class="col-6 col-sm-4 col-lg-3 col-xl-2">
							<div class="card">
								<a href="{% url 'details' slug=item.slug %}" class="card__cover">
									<img src="{{item.coverphoto.url}}" alt="">
								</a>
								<span class="card__rating">{{item.price}} $</span>
								<h3 class="card__title"><a href="{% url 'details' slug=item.slug%}">{{item.movie_name}}</a></h3>
								<ul class="card__list">
									<li>{{item.quality}}</li>
									<li>{{item.price}} $</li>
									<li>{{item.duration}} min</li>
								</ul>
								{% if user.is_authenticated %}
								
								{% if item in itemsincart %}

								<script>
									counterlocal=0
									ct=document.getElementById('counter')

									function add_item(id){
										if (counterlocal>={{product.limit}}){
											alert('limit reached')
											return
										}
										//url="{% url 'add_cart_album' product_id=item.id album_price=product.price %}"
										//alert(url)
										addurl="{% url 'inc_counter' album_id=product.id movie_id=item.id %}"
										//alert(url)
										//fetch(url)
										fetch(addurl).then(response=>response.json()).then(data=>{
											ct.textContent=data.count+" Items in Album"

										}).catch(error => {
											// Handle any errors here
											console.error(error);
							
																		})
											
																	
										}
									add_item({{item.id}})
								</script>
								<button dec-url="{% url 'dec_counter' album_id=product.id movie_id=item.id %}"data-url={% url 'remove_item' item.id %} id="item_remove_{{item.id}}" onclick="remove_item({{item.id}})"  class="sign__btn">Added</button>
								{% else %}
								<button inc-url="{% url 'inc_counter' album_id=product.id movie_id=item.id %}"data-url="{% url 'add_cart_album' product_id=item.id album_price=product.price %}" id="item_add_{{item.id}}" onclick="add_item({{item.id}})"  class="sign__btn">Add to Album</button>
								{% endif %}
								<button dec-url="{% url 'dec_counter' album_id=product.id movie_id=item.id  %}" style="display:none" data-url={% url 'remove_item' item.id %} id="item_remove_{{item.id}}" onclick="remove_item({{item.id}})"  class="sign__btn">Added</button>

								<button inc-url="{% url 'inc_counter' album_id=product.id movie_id=item.id %}" style="display:none" data-url="{% url 'add_cart_album' item.id product.price %}" id="item_add_{{item.id}}" onclick="add_item({{item.id}})"  class="sign__btn">Add to Album</button>


	     {% else %}		
		<a href="{% url 'login' %}" <button   class="sign__btn">Add to Album</button></button></a>
		<a href="{% url 'login' %}" <button  style="display:none;" class="sign__btn">Added</button></a>
{% endif %}
							</div>
						</div>
					
					
						{% endfor %}</div>
					
				</div>


          {% if user.is_authenticated %}
		  <button id="disable_cart" disabled style="display:none;width:40%;" class="sign__btn">Insert More Items</button>
	<a id="enable_cart" href='{% url 'cart_album' album_price=product.price album_name=product.album_name %}' style="display:none;width:40%;" class="sign__btn">Show Cart</a>
	     {% else %}		
		 <a href='{% url 'login' %}' style="width:40%;" class="sign__btn">Show Cart</a>
		 {% endif %}


			</div>
			<!-- end article -->
		</div>
		<div class="row">
			<div class="col-12">
				<div class="catalog__paginator-wrap">
					<span class="catalog__pages">10 from {{count}}</span>

					<ul class="catalog__paginator">
						<nav class="mt-4" aria-label="Page navigation sample">
							{% if all_products.has_other_pages %}
							<ul class="pagination" style='display: flex;
							margin-bottom: 13px;'>
								{% if all_products.has_previous %}
								<li class="page-item "><a class="page-link"
										href="?page={{all_products.previous_page_number}}">Previous</a></li>
								{% else %}
								<li class="page-item disabled"><a class="page-link" href="">Previous</a></li>
								{% endif %}
		
								{% for i in all_products.paginator.page_range %}
								{% if all_products.number == i %}
								<li class="page-item active"><a class="page-link" href="#">{{i}}</a></li>
								{% else %}
								<li class="page-item "><a class="page-link" href="?page={{i}}">{{i}}</a></li>
								{% endif %}
								{% endfor %}
								{% if all_products.has_next %}
								<li class="page-item"><a class="page-link active" href="?page={{all_products.next_page_number}}">Next</a></li>
								{% else %}
								<li class="page-item disabled"><a class="page-link " href="#">Next</a></li>
								{% endif %}
							</ul>
							{% endif %}
						</nav>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</section>
	<!-- end details -->

	<!-- similar -->
	
	<!-- end similar -->
	{% include 'include/footer.html' %}
	






<script>


// Check if the page has a stored flag indicating it has been reloaded

// If the flag is not set, reload the page and set the flag

window.onpageshow = function(event) {
	if (event.persisted) {
		// Force a page reload
		window.location.reload();
	}
};

disable_cart=document.getElementById('disable_cart')
enable_cart=document.getElementById('enable_cart')
if ({{counter}}>={{product.limit}}){
enable_cart.style.display="flex"
}else{
	remaining={{product.limit}}-{{counter}}
	
	disable_cart.style.display="block"
	disable_cart.textContent="Insert More Items("+remaining+" remaining)"
}
var	counterlocal={{counter}}
 cart=document.getElementById('cart-value')
ct=document.getElementById('counter')
	function add_item(id){
		if (counterlocal>={{product.limit}}){
			alert('limit reached')
			return
		}
		add=document.getElementById('item_add_'+id)
		remove=document.getElementById('item_remove_'+id)
		url=add.getAttribute('data-url')
		addurl=add.getAttribute('inc-url')
		fetch(url)
		fetch(addurl)
		counterlocal++
		if (counterlocal>={{product.limit}}){
			enable_cart.style.display="flex"
			disable_cart.style.display="none"
		}else{
			remaining={{product.limit}}-counterlocal
			disable_cart.textContent="Insert More Items("+remaining+" remaining)"

		}
		ct.textContent=counterlocal+" items added in album"
		cart.textContent=parseInt(cart.textContent)+1
		add.style.display="none"
		remove.style.display="block"
	}
	function remove_item(id){
		add=document.getElementById('item_add_'+id)
		remove=document.getElementById('item_remove_'+id)
		url=remove.getAttribute('data-url')
		removeurl=remove.getAttribute('dec-url')
		fetch(url)

		
		fetch(removeurl)
		
		counterlocal--
		if (counterlocal<{{product.limit}}){
			remaining={{product.limit}}-counterlocal
	
			disable_cart.style.display="block"
			disable_cart.textContent="Insert More Items("+remaining+" remaining)"
					enable_cart.style.display="none"
		}
		if (counterlocal<0){
			counterlocal=0
		}
		ct.textContent=counterlocal+" items added in album"
		cart.textContent=parseInt(cart.textContent)-1
		add.style.display="block"
		remove.style.display="none"	
}
	function redirecter(e){
		e.preventDefault()
		window.location.replace('/myaccounts/login')
		return 
	}
</script>

{% endblock %}
